# Advent of Code (AoC) - day 11, task 1

import "prelude.eg"

using System, OS, List, String (from_chars, to_chars), R = Regex, D = Dict

def parse = do R::matches (R::compile "[a-z]+")

def count = 
    [D -> fix [F M X -> 
        if X == "out" then 1
        else if Dict::has D X then map [Y -> D::memo M F Y] (Dict::get D X) |> sum
        else 0 ]]

def main =
    read_lines stdin |> map parse |> foldl [D {X|YY} -> Dict::set D X YY] Dict::dict
    |> [D -> count D D::dict "you"]
